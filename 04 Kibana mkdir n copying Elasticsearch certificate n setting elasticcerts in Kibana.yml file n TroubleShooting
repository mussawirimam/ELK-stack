### topic: integration of elasticsearch, kibana configuration, kibana certificates, and how we will starting kibana
# kibana certificates and how to integrate the elasticsearch certificates with kibana
# from previous we have elasticsearch running with the certificates configured.

root@kibana:~# systemctl status elasticsearch
‚óè elasticsearch.service - Elasticsearch
     Loaded: loaded (/usr/lib/systemd/system/elasticsearch.service; enabled; preset: enabled)
     Active: active (running) since Sun 2025-03-30 20:40:52 EDT; 2 days ago
       Docs: https://www.elastic.com...

##################### KIBANA ##################
# we need to create elasticsearch id and password through the api (download postman or you can do it on your system as well)
in postman POST https://192.xxx.xxx.xxx:9200/_security/user/kibana_system/_password

To create new user name and password:
# change the password to the one your system generated.
#curl -X POST "http://localhost:9200/_security/user/kibana_system/_password" -u elastic:cENFFOQ_4GUDyU-poCts -H "Content-Type: application/json" -d '{"password": "123456789"}'
#curl -X POST "https://localhost:9200/_security/user/kibana_system/_password" -u elastic:cENFFOQ_4GUDyU-poCts -H "Content-Type: application/json" -d '{"password": "123456789"}' -k

Elsatic auth roles https://www.elastic.co/guide/en/elasticsearch/reference/current/built-in-roles.html

### id and password was created successfully with empty response in the bracket 
# username for kibana: kibana_system
# password: 123456789
root@kibana:~# curl -X POST "https://localhost:9200/_security/user/kibana_system/_password" -u elastic:=VkEPC-DbgU5p-P1waQH -H "Content-Type: application/json" -d '{"password": "123456789"}' -k
{}root@kibana:~#

### if you are not using the superuser and user the kibana user, we will be able to login. And also, run the elasticsearch api's as well.
as well as the uri's

### now we have to configure the kibana user and password in the /etc/kibana/kibana.yml file and the path to the certificates

# if you see the kibana is running with the kibana user
root@kibana:/etc/kibana# ll
total 32
drwxr-s---   2 root kibana  4096 Apr  1 22:22 ./
drwxr-xr-x 143 root root   12288 Mar 31 01:02 ../
-rw-rw----   1 root kibana   130 Mar 31 01:03 kibana.keystore
-rw-rw----   1 root kibana  7818 Apr  1 22:22 kibana.yml
-rw-rw-r--   1 root kibana   447 Jun 10  2024 node.options
root@kibana:/etc/kibana#

# mkdir should have kibana user permisison
root@kibana:/etc/kibana# mkdir certs
root@kibana:/etc/kibana# ll
total 36
drwxr-s---   3 root kibana  4096 Apr  1 22:23 ./
drwxr-xr-x 143 root root   12288 Mar 31 01:02 ../
drwxr-sr-x   2 root kibana  4096 Apr  1 22:23 certs/
-rw-rw----   1 root kibana   130 Mar 31 01:03 kibana.keystore
-rw-rw----   1 root kibana  7818 Apr  1 22:22 kibana.yml
-rw-rw-r--   1 root kibana   447 Jun 10  2024 node.options
root@kibana:/etc/kibana#

[root@localhost kibana]# cd certs/
[root@localhost certs]# pwd
/etc/kibana/certs
[root@localhost certs]# 

### now we have to copy our certificates to certs location within /etc/kibana/certs. We are copying elasticsearch certificates. 
root@kibana:/etc/kibana/certs# ls /etc/elasticsearch/certs/
ca/              ca_elastic.zip   certificate.zip  elastic/         http_ca.crt      http.p12         transport.p12

root@kibana:/etc/kibana/certs# cp -r /etc/elasticsearch/certs/ca .
root@kibana:/etc/kibana/certs# ll
total 12
drwxr-sr-x 3 root kibana 4096 Apr  1 22:25 ./
drwxr-s--- 3 root kibana 4096 Apr  1 22:23 ../
drwxr-sr-x 2 root kibana 4096 Apr  1 22:25 ca/
root@kibana:/etc/kibana/certs# cp -r /etc/elasticsearch/certs/elastic .
root@kibana:/etc/kibana/certs# ll
total 16
drwxr-sr-x 4 root kibana 4096 Apr  1 22:25 ./
drwxr-s--- 3 root kibana 4096 Apr  1 22:23 ../
drwxr-sr-x 2 root kibana 4096 Apr  1 22:25 ca/
drwxr-sr-x 2 root kibana 4096 Apr  1 22:25 elastic/

### good thing is that the user previledges is kibana  
[root@localhost certs]#  ls -Rl
.:
total 0
drwxr-sr-x. 2 root kibana 34 Apr 16 21:03 ca
drwxr-sr-x. 2 root kibana 44 Apr 16 21:04 elastic

./ca:
total 8
-rwxr-xr-x. 1 root kibana 1220 Apr 16 21:03 ca.crt
-rwxr-xr-x. 1 root kibana 1675 Apr 16 21:03 ca.key

./elastic:
total 8
-rwxr-xr-x. 1 root kibana 1176 Apr 16 21:04 elastic.crt
-rwxr-xr-x. 1 root kibana 1675 Apr 16 21:04 elastic.key
[root@localhost certs]#
------------------------------------------------------------------------------------------


### we have to configure this /etc/kibana/certs/elastic certificate and key and also the certificate authroity ca within the kibana.yml file 
#if our certificate was public, then we wouldnt give the elastic ca
# in some cases we will be doing ca configuration in organization as well but they will be provided to you whoever is managing ssl 

### ca, crt and key needs to be added in the kibana.yml file that you just copied

root@kibana:/etc/kibana/certs# cd -
/etc/kibana
root@kibana:/etc/kibana# vim kibana.yml
root@kibana:/etc/kibana# cat kibana.yml
# For more configuration options see the configuration guide for Kibana in
# https://www.elastic.co/guide/index.html

# =================== System: Kibana Server ===================
# Kibana is served by a back end server. This setting specifies the port to use.
server.port: 5601

# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: "localhost"

# Enables you to specify a path to mount Kibana at if you are running behind a proxy.
# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath
# from requests it receives, and to prevent a deprecation warning at startup.
# This setting cannot end in a slash.
#server.basePath: ""

# Specifies whether Kibana should rewrite requests that are prefixed with
# `server.basePath` or require that they are rewritten by your reverse proxy.
# Defaults to `false`.
#server.rewriteBasePath: false

# Specifies the public URL at which Kibana is available for end users. If
# `server.basePath` is configured this URL should end with the same basePath.
server.publicBaseUrl: "https://localhost:5601/"

# The maximum payload size in bytes for incoming server requests.
#server.maxPayload: 1048576

# The Kibana server's name. This is used for display purposes.
#server.name: "your-hostname"

# =================== System: Kibana Server (Optional) ===================
# Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.
# These settings enable SSL for outgoing requests from the Kibana server to the browser.
server.ssl.enabled: false
#server.ssl.certificate: /path/to/your/server.crt
#server.ssl.key: /path/to/your/server.key

# =================== System: Elasticsearch ===================
# The URLs of the Elasticsearch instances to use for all your queries.
elasticsearch.hosts: ["http://localhost:9200"]

# If your Elasticsearch is protected with basic authentication, these settings provide
# the username and password that the Kibana server uses to perform maintenance on the Kibana
# index at startup. Your Kibana users still need to authenticate with Elasticsearch, which
# is proxied through the Kibana server.
elasticsearch.username: "kibana_system"
elasticsearch.password: "123456789"

# Kibana can also authenticate to Elasticsearch via "service account tokens".
# Service account tokens are Bearer style tokens that replace the traditional username/password based configuration.
# Use this token instead of a username/password.
# elasticsearch.serviceAccountToken: "my_token"

# Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of
# the elasticsearch.requestTimeout setting.
#elasticsearch.pingTimeout: 1500

# Time in milliseconds to wait for responses from the back end or Elasticsearch. This value
# must be a positive integer.
#elasticsearch.requestTimeout: 30000

# The maximum number of sockets that can be used for communications with elasticsearch.
# Defaults to `Infinity`.
#elasticsearch.maxSockets: 1024

# Specifies whether Kibana should use compression for communications with elasticsearch
# Defaults to `false`.
#elasticsearch.compression: false

# List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side
# headers, set this value to [] (an empty list).
#elasticsearch.requestHeadersWhitelist: [ authorization ]

# Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten
# by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.
#elasticsearch.customHeaders: {}

# Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.
#elasticsearch.shardTimeout: 30000

# =================== System: Elasticsearch (Optional) ===================
# These files are used to verify the identity of Kibana to Elasticsearch and are required when
# xpack.security.http.ssl.client_authentication in Elasticsearch is set to required.
elasticsearch.ssl.certificate: /etc/kibana/certs/elastic/elastic.crt     #<-------------------------
elasticsearch.ssl.key: /etc/kibana/certs/elastic/elastic.key             #<-------------------------

# Enables you to specify a path to the PEM file for the certificate
# authority for your Elasticsearch instance.
elasticsearch.ssl.certificateAuthorities: [ "/etc/kibana/certs/ca/ca.crt" ]     #<-------------------------

# To disregard the validity of SSL certificates, change this setting's value to 'none'.
#elasticsearch.ssl.verificationMode: full

# =================== System: Logging ===================
# Set the value of this setting to off to suppress all logging output, or to debug to log everything. Defaults to 'info'
#logging.root.level: debug

# Enables you to specify a file where Kibana stores log output.
logging:
  appenders:
    file:
      type: file
      fileName: /var/log/kibana/kibana.log
      layout:
        type: json
  root:
    appenders:
      - default
      - file
#  policy:
#    type: size-limit
#    size: 256mb
#  strategy:
#    type: numeric
#    max: 10
#  layout:
#    type: json

# Logs queries sent to Elasticsearch.
#logging.loggers:
#  - name: elasticsearch.query
#    level: debug

# Logs http responses.
#logging.loggers:
#  - name: http.server.response
#    level: debug

# Logs system usage information.
#logging.loggers:
#  - name: metrics.ops
#    level: debug

# Enables debug logging on the browser (dev console)
#logging.browser.root:
#  level: debug

# =================== System: Other ===================
# The path where Kibana stores persistent data not saved in Elasticsearch. Defaults to data
#path.data: data

# Specifies the path where Kibana creates the process ID file.
pid.file: /run/kibana/kibana.pid

# Set the interval in milliseconds to sample system and process performance
# metrics. Minimum is 100ms. Defaults to 5000ms.
#ops.interval: 5000

# Specifies locale to be used for all localizable strings, dates and number formats.
# Supported languages are the following: English (default) "en", Chinese "zh-CN", Japanese "ja-JP", French "fr-FR".
#i18n.locale: "en"

# =================== Frequently used (Optional)===================

# =================== Saved Objects: Migrations ===================
# Saved object migrations run at startup. If you run into migration-related issues, you might need to adjust these settings.

# The number of documents migrated at a time.
# If Kibana can't start up or upgrade due to an Elasticsearch `circuit_breaking_exception`,
# use a smaller batchSize value to reduce the memory pressure. Defaults to 1000 objects per batch.
#migrations.batchSize: 1000

# The maximum payload size for indexing batches of upgraded saved objects.
# To avoid migrations failing due to a 413 Request Entity Too Large response from Elasticsearch.
# This value should be lower than or equal to your Elasticsearch cluster‚Äôs `http.max_content_length`
# configuration option. Default: 100mb
#migrations.maxBatchSizeBytes: 100mb

# The number of times to retry temporary migration failures. Increase the setting
# if migrations fail frequently with a message such as `Unable to complete the [...] step after
# 15 attempts, terminating`. Defaults to 15
#migrations.retryAttempts: 15

# =================== Search Autocomplete ===================
# Time in milliseconds to wait for autocomplete suggestions from Elasticsearch.
# This value must be a whole number greater than zero. Defaults to 1000ms
#unifiedSearch.autocomplete.valueSuggestions.timeout: 1000

# Maximum number of documents loaded by each shard to generate autocomplete suggestions.
# This value must be a whole number greater than zero. Defaults to 100_000
#unifiedSearch.autocomplete.valueSuggestions.terminateAfter: 100000
root@kibana:/etc/kibana#

------------------------------------------------------------------------------------------------
### now we can start the kibana service
# it is not interactive, it is trying to start in backend (you will not see the output on the console)
root@kibana:/etc/kibana# systemctl start kibana
root@kibana:/etc/kibana#
root@kibana:/etc/kibana# systemctl status kibana
‚óè kibana.service - Kibana
     Loaded: loaded (/usr/lib/systemd/system/kibana.service; disabled; preset: enabled)
     Active: active (running) since Mon 2025-03-31 01:06:23 EDT; 1 day 21h ago
       Docs: https://www.elastic.co
   Main PID: 5292 (node)
      Tasks: 11 (limit: 10061)
     Memory: 288.6M (peak: 344.2M)
        CPU: 1min 8.346s
     CGroup: /system.slice/kibana.service
             ‚îî‚îÄ5292 /usr/share/kibana/bin/../node/bin/node /usr/share/kibana/bin/../src/cli/dist

Mar 31 01:06:26 kibana kibana[5292]: Native global console methods have been overridden in production environment.
Mar 31 01:06:29 kibana kibana[5292]: [2025-03-31T01:06:29.399-04:00][INFO ][root] Kibana is starting
Mar 31 01:06:29 kibana kibana[5292]: [2025-03-31T01:06:29.607-04:00][INFO ][node] Kibana process configured with roles: [background_tasks, ui]
Mar 31 01:06:45 kibana kibana[5292]: [2025-03-31T01:06:45.784-04:00][INFO ][plugins-service] The following plugins are disabled: "cloudChat,cloudExperiment>
Mar 31 01:06:46 kibana kibana[5292]: [2025-03-31T01:06:45.964-04:00][INFO ][http.server.Preboot] http server running at http://localhost:5601
Mar 31 01:06:46 kibana kibana[5292]: [2025-03-31T01:06:46.391-04:00][INFO ][plugins-system.preboot] Setting up [1] plugins: [interactiveSetup]
Mar 31 01:06:46 kibana kibana[5292]: [2025-03-31T01:06:46.430-04:00][INFO ][preboot] "interactiveSetup" plugin is holding setup: Validating Elasticsearch c>
Mar 31 01:06:46 kibana kibana[5292]: [2025-03-31T01:06:46.531-04:00][INFO ][root] Holding setup until preboot stage is completed.
Mar 31 01:06:47 kibana kibana[5292]: i Kibana has not been configured.
Mar 31 01:06:47 kibana kibana[5292]: Go to http://localhost:5601/?code=611852 to get started.
lines 1-21/21 (END)

[root@localhost kibana]# systemctl enable kibana.service
Created symlink /etc/systemd/system/multi-user.target.wants/kibana.service ‚Üí /usr/lib/systemd/system/kibana.service.
[root@localhost kibana]#

[root@localhost kibana]# systemctl status kibana.service
√ó kibana.service - Kibana
     Loaded: loaded (/usr/lib/systemd/system/kibana.service; enabled; preset: disabled)
     Active: failed (Result: exit-code) since Wed 2025-04-16 21:12:43 EDT; 3min 21s ago
   Duration: 2.483s
       Docs: https://www.elastic.co
   Main PID: 10968 (code=exited, status=1/FAILURE)
        CPU: 2.781s

Apr 16 21:12:43 localhost.localdomain systemd[1]: kibana.service: Scheduled restart job, restart counter is at 3.
Apr 16 21:12:43 localhost.localdomain systemd[1]: Stopped Kibana.
Apr 16 21:12:43 localhost.localdomain systemd[1]: kibana.service: Consumed 2.781s CPU time.
Apr 16 21:12:43 localhost.localdomain systemd[1]: kibana.service: Start request repeated too quickly.
Apr 16 21:12:43 localhost.localdomain systemd[1]: kibana.service: Failed with result 'exit-code'.     <------------------------
Apr 16 21:12:43 localhost.localdomain systemd[1]: Failed to start Kibana.     <---------------------------
[root@localhost kibana]#

################################ trouble shooting time: the kibana is not running on the browser ##################################
root@kibana:/etc/kibana# cd /var/log/kibana/
root@kibana:/var/log/kibana# ls
kibana.log

### elasticsearch is not being able to communicate with the kibana
root@kibana:/var/log/kibana# more kibana.log |grep -v INFO
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T22:52:36.793-04:00","message":"Unable to retrieve version information from Elasticsearch nodes. socket hang up - Local: 127.0.0.1:34408, Remote: 127.0.0.1:9200","log":{"level":"ERROR","logger":"elasticsearch-service"},"process":{"pid":8609,"uptime":161.305614067},"trace":{"id":"0517b877291ddc52998712097c9850a4"},"transaction":{"id":"6c35829336e39003"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T22:52:37.291-04:00","message":"Unable to retrieve version information from Elasticsearch nodes. socket hang up - Local: 127.0.0.1:34446, Remote: 127.0.0.1:9200","log":{"level":"ERROR","logger":"elasticsearch-service"},"process":{"pid":8609,"uptime":161.803699669},"trace":{"id":"0517b877291ddc52998712097c9850a4"},"transaction":{"id":"6c35829336e39003"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T22:52:37.789-04:00","message":"Unable to retrieve version information from Elasticsearch nodes. socket hang up - Local: 127.0.0.1:34498, Remote: 127.0.0.1:9200","log":{"level":"ERROR","logger":"elasticsearch-service"},"process":{"pid":8609,"uptime":162.301106377},"trace":{"id":"0517b877291ddc52998712097c9850a4"},"transaction":{"id":"6c35829336e39003"}}
root@kibana:/var/log/kibana#

### add replace in the kibana.yml file 
Key Observations and Suggestions:
Server Host Configuration:

1. Currently, server.host is set to localhost, which means Kibana will only be accessible from the local machine. If you want to allow remote access to Kibana, you should change this to 0.0.0.0 or the specific IP address of your server.
server.host: "0.0.0.0"

2. Public Base URL:

Your server.publicBaseUrl is set to https://localhost:5601/. This should ideally be the public URL at which users can access Kibana. If Kibana is accessed over HTTP or from a remote IP, you should adjust this URL to reflect that.

Example if using HTTP and accessible externally:
server.publicBaseUrl: "http://your-server-ip:5601/"

### check if the versions are matching for kibana and elasticsearch:
root@kibana:/etc/kibana/certs/elastic# /usr/share/elasticsearch/bin/elasticsearch --version
Version: 8.14.1, Build: deb/93a57a1a76f556d8aee6a90d1a95b06187501310/2024-06-10T23:35:17.114581191Z, JVM: 22.0.1
root@kibana:/etc/kibana/certs/elastic#


root@kibana:/etc/kibana/certs/elastic# /usr/share/kibana/bin/kibana --version
{"log.level":"info","@timestamp":"2025-04-02T03:10:32.999Z","log.logger":"elastic-apm-node","ecs.version":"8.10.0","agentVersion":"4.5.0","env":{"pid":9007,"proctitle":"/usr/share/kibana/bin/../node/bin/node","os":"linux 6.11.0-21-generic","arch":"x64","host":"kibana","timezone":"UTC-0400","runtime":"Node.js v20.13.1"},"config":{"active":{"source":"start","value":true},"breakdownMetrics":{"source":"start","value":false},"captureBody":{"source":"start","value":"off","commonName":"capture_body"},"captureHeaders":{"source":"start","value":false},"centralConfig":{"source":"start","value":false},"contextPropagationOnly":{"source":"start","value":true},"environment":{"source":"start","value":"production"},"globalLabels":{"source":"start","value":[["kibana_uuid","ece5f525-f465-4e96-9fd1-dddae1822d7a"],["git_rev","afbd904e868f2a48a2bbeb8ff20baee8d4aeb468"]],"sourceValue":{"kibana_uuid":"ece5f525-f465-4e96-9fd1-dddae1822d7a","git_rev":"afbd904e868f2a48a2bbeb8ff20baee8d4aeb468"}},"logLevel":{"source":"default","value":"info","commonName":"log_level"},"metricsInterval":{"source":"start","value":120,"sourceValue":"120s"},"serverUrl":{"source":"start","value":"https://kibana-cloud-apm.apm.us-east-1.aws.found.io/","commonName":"server_url"},"transactionSampleRate":{"source":"start","value":0.1,"commonName":"transaction_sample_rate"},"captureSpanStackTraces":{"source":"start","sourceValue":false},"secretToken":{"source":"start","value":"[REDACTED]","commonName":"secret_token"},"serviceName":{"source":"start","value":"kibana","commonName":"service_name"},"serviceVersion":{"source":"start","value":"8.14.1","commonName":"service_version"}},"activationMethod":"require","message":"Elastic APM Node.js Agent v4.5.0"}
Kibana should not be run as root.  Use --allow-root to continue.


root@kibana:/etc/kibana/certs/elastic# sudo -u kibana /usr/share/kibana/bin/kibana --version
{"log.level":"info","@timestamp":"2025-04-02T03:12:02.015Z","log.logger":"elastic-apm-node","ecs.version":"8.10.0","agentVersion":"4.5.0","env":{"pid":9023,"proctitle":"/usr/share/kibana/bin/../node/bin/node","os":"linux 6.11.0-21-generic","arch":"x64","host":"kibana","timezone":"UTC-0400","runtime":"Node.js v20.13.1"},"config":{"active":{"source":"start","value":true},"breakdownMetrics":{"source":"start","value":false},"captureBody":{"source":"start","value":"off","commonName":"capture_body"},"captureHeaders":{"source":"start","value":false},"centralConfig":{"source":"start","value":false},"contextPropagationOnly":{"source":"start","value":true},"environment":{"source":"start","value":"production"},"globalLabels":{"source":"start","value":[["kibana_uuid","ece5f525-f465-4e96-9fd1-dddae1822d7a"],["git_rev","afbd904e868f2a48a2bbeb8ff20baee8d4aeb468"]],"sourceValue":{"kibana_uuid":"ece5f525-f465-4e96-9fd1-dddae1822d7a","git_rev":"afbd904e868f2a48a2bbeb8ff20baee8d4aeb468"}},"logLevel":{"source":"default","value":"info","commonName":"log_level"},"metricsInterval":{"source":"start","value":120,"sourceValue":"120s"},"serverUrl":{"source":"start","value":"https://kibana-cloud-apm.apm.us-east-1.aws.found.io/","commonName":"server_url"},"transactionSampleRate":{"source":"start","value":0.1,"commonName":"transaction_sample_rate"},"captureSpanStackTraces":{"source":"start","sourceValue":false},"secretToken":{"source":"start","value":"[REDACTED]","commonName":"secret_token"},"serviceName":{"source":"start","value":"kibana","commonName":"service_name"},"serviceVersion":{"source":"start","value":"8.14.1","commonName":"service_version"}},"activationMethod":"require","message":"Elastic APM Node.js Agent v4.5.0"}
8.14.1
root@kibana:/etc/kibana/certs/elastic#

...
# =================== System: Elasticsearch ===================
# The URLs of the Elasticsearch instances to use for all your queries.
elasticsearch.hosts: ["http://localhost:9200"] url needs to be https

# if we are getting the errors for elasticsearch, so we have to look for elasticsearch related error possibilities
### changes made: we have to provide https because we running with the self signed certificates
# =================== System: Elasticsearch ===================
# The URLs of the Elasticsearch instances to use for all your queries.
elasticsearch.hosts: ["https://localhost:9200"]

root@kibana:/etc/kibana/certs/elastic# systemctl stop kibana
root@kibana:/etc/kibana/certs/elastic# systemctl start kibana

### since we are running our certificates with the DNS:sys.fcc it is not able to connect with the localhost
root@kibana:/etc/kibana/certs/elastic# more /var/log/kibana/kibana.log | grep -v INFO,WARN
"1f7c507f3282ccac"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T23:23:31.462-04:00","message":"Server is NOT enabled","log":{"level":"INFO","logger":"plugins.assetManager"},"process":{"pid":9313,"uptime":44.035434505},"trace":{"id":"567594c9c6be49cf5694cea43190fa47"},"transaction":{"id":"1f7c507f3282ccac"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T23:23:32.908-04:00","message":"Unable to retrieve version information from Elasticsearch nodes. Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:sys.fcc","log":{"level":"ERROR","logger":"elasticsearch-service"},"process":{"pid":9313,"uptime":45.48194476},"trace":{"id":"567594c9c6be49cf5694cea43190fa47"},"transaction":{"id":"1f7c507f3282ccac"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-01T23:23:35.619-04:00","message":"Browser executable: /usr/share/kibana/node_modules/@kbn/screenshotting-plugin/chromium/headless_shell-linux_x64/headless_shell","log":{"level":"INFO","logger":"plugins.screenshotting.chromium"},"process":{"pid":9313,"uptime":48.192699697},"trace":{"id":"567594c9c6be49cf5694cea43190fa47"},"transaction":{"id":"1f7c507f3282ccac"}}
root@kibana:/etc/kibana/certs/elastic#

### made changes in to the kibana.yml file to add this as the value in line #42 elasticsearch.hosts: ["https://sys.fcc:9200"] and the error went away.       
root@kibana:/etc/kibana/certs/elastic# vim /etc/kibana/kibana.yml
root@kibana:/var/log/kibana# cat -n /etc/kibana/kibana.yml
     1  # For more configuration options see the configuration guide for Kibana in
     2  # https://www.elastic.co/guide/index.html
     3
     4  # =================== System: Kibana Server ===================
     5  # Kibana is served by a back end server. This setting specifies the port to use.
     6  server.port: 5601
     7
     8  # Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
     9  # The default is 'localhost', which usually means remote machines will not be able to connect.
    10  # To allow connections from remote users, set this parameter to a non-loopback address.
    11  server.host: "0.0.0.0"
    12
    13  # Enables you to specify a path to mount Kibana at if you are running behind a proxy.
    14  # Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath
    15  # from requests it receives, and to prevent a deprecation warning at startup.
    16  # This setting cannot end in a slash.
    17  #server.basePath: ""
    18
    19  # Specifies whether Kibana should rewrite requests that are prefixed with
    20  # `server.basePath` or require that they are rewritten by your reverse proxy.
    21  # Defaults to `false`.
    22  #server.rewriteBasePath: false
    23
    24  # Specifies the public URL at which Kibana is available for end users. If
    25  # `server.basePath` is configured this URL should end with the same basePath.
    26  server.publicBaseUrl: "https://192.168.29.137:5601/"
    27
    28  # The maximum payload size in bytes for incoming server requests.
    29  #server.maxPayload: 1048576
    30
    31  # The Kibana server's name. This is used for display purposes.
    32  #server.name: "your-hostname"
    33
    34  # =================== System: Kibana Server (Optional) ===================
    35  # Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.
    36  # These settings enable SSL for outgoing requests from the Kibana server to the browser.
    37  #server.ssl.enabled: Flase
    38  #server.ssl.certificate: /path/to/your/server.crt
    39  #server.ssl.key: /path/to/your/server.key
    40
    41  # =================== System: Elasticsearch ===================
    42  # The URLs of the Elasticsearch instances to use for all your queries.
    43  elasticsearch.hosts: ["https://sys.fcc:9200"]                    #<-----------------------------------------
    44
    45  # If your Elasticsearch is protected with basic authentication, these settings provide
    46  # the username and password that the Kibana server uses to perform maintenance on the Kibana
    47  # index at startup. Your Kibana users still need to authenticate with Elasticsearch, which
    48  # is proxied through the Kibana server.
    49  elasticsearch.username: "kibana_system"
    50  elasticsearch.password: "123456789"
    51
    52  # Kibana can also authenticate to Elasticsearch via "service account tokens".
    53  # Service account tokens are Bearer style tokens that replace the traditional username/password based configuration.
    54  # Use this token instead of a username/password.
    55  # elasticsearch.serviceAccountToken: "my_token"
    56
    57  # Time in milliseconds to wait for Elasticsearch to respond to pings. Defaults to the value of
    58  # the elasticsearch.requestTimeout setting.
    59  #elasticsearch.pingTimeout: 1500
    60
    61  # Time in milliseconds to wait for responses from the back end or Elasticsearch. This value
    62  # must be a positive integer.
    63  #elasticsearch.requestTimeout: 30000
    64
    65  # The maximum number of sockets that can be used for communications with elasticsearch.
    66  # Defaults to `Infinity`.
    67  #elasticsearch.maxSockets: 1024
    68
    69  # Specifies whether Kibana should use compression for communications with elasticsearch
    70  # Defaults to `false`.
    71  #elasticsearch.compression: false
    72
    73  # List of Kibana client-side headers to send to Elasticsearch. To send *no* client-side
    74  # headers, set this value to [] (an empty list).
    75  #elasticsearch.requestHeadersWhitelist: [ authorization ]
    76
    77  # Header names and values that are sent to Elasticsearch. Any custom headers cannot be overwritten
    78  # by client-side headers, regardless of the elasticsearch.requestHeadersWhitelist configuration.
    79  #elasticsearch.customHeaders: {}
    80
    81  # Time in milliseconds for Elasticsearch to wait for responses from shards. Set to 0 to disable.
    82  #elasticsearch.shardTimeout: 30000
    83
    84  # =================== System: Elasticsearch (Optional) ===================
    85  # These files are used to verify the identity of Kibana to Elasticsearch and are required when
    86  # xpack.security.http.ssl.client_authentication in Elasticsearch is set to required.
    87  elasticsearch.ssl.certificate: /etc/kibana/certs/elastic/elastic.crt
    88  elasticsearch.ssl.key: /etc/kibana/certs/elastic/elastic.key
    89
    90  # Enables you to specify a path to the PEM file for the certificate
    91  # authority for your Elasticsearch instance.
    92  elasticsearch.ssl.certificateAuthorities: [ "/etc/kibana/certs/ca/ca.crt" ]
    93
    94  # To disregard the validity of SSL certificates, change this setting's value to 'none'.
    95  #elasticsearch.ssl.verificationMode: full
    96
    97  # =================== System: Logging ===================
    98  # Set the value of this setting to off to suppress all logging output, or to debug to log everything. Defaults to 'info'
    99  #logging.root.level: debug
   100
   101  # Enables you to specify a file where Kibana stores log output.
   102  logging:
   103    appenders:
   104      file:
   105        type: file
   106        fileName: /var/log/kibana/kibana.log
   107        layout:
   108          type: json
   109    root:
   110      appenders:
   111        - default
   112        - file
   113  #  policy:
   114  #    type: size-limit
   115  #    size: 256mb
   116  #  strategy:
   117  #    type: numeric
   118  #    max: 10
   119  #  layout:
   120  #    type: json
   121
   122  # Logs queries sent to Elasticsearch.
   123  #logging.loggers:
   124  #  - name: elasticsearch.query
   125  #    level: debug
   126
   127  # Logs http responses.
   128  #logging.loggers:
   129  #  - name: http.server.response
   130  #    level: debug
   131
   132  # Logs system usage information.
   133  #logging.loggers:
   134  #  - name: metrics.ops
   135  #    level: debug
   136
   137  # Enables debug logging on the browser (dev console)
   138  #logging.browser.root:
   139  #  level: debug
   140
   141  # =================== System: Other ===================
   142  # The path where Kibana stores persistent data not saved in Elasticsearch. Defaults to data
   143  #path.data: data
   144
   145  # Specifies the path where Kibana creates the process ID file.
   146  pid.file: /run/kibana/kibana.pid
   147
   148  # Set the interval in milliseconds to sample system and process performance
   149  # metrics. Minimum is 100ms. Defaults to 5000ms.
   150  #ops.interval: 5000
   151
   152  # Specifies locale to be used for all localizable strings, dates and number formats.
   153  # Supported languages are the following: English (default) "en", Chinese "zh-CN", Japanese "ja-JP", French "fr-FR".
   154  #i18n.locale: "en"
   155
   156  # =================== Frequently used (Optional)===================
   157
   158  # =================== Saved Objects: Migrations ===================
   159  # Saved object migrations run at startup. If you run into migration-related issues, you might need to adjust these settings.
   160
   161  # The number of documents migrated at a time.
   162  # If Kibana can't start up or upgrade due to an Elasticsearch `circuit_breaking_exception`,
   163  # use a smaller batchSize value to reduce the memory pressure. Defaults to 1000 objects per batch.
   164  #migrations.batchSize: 1000
   165
   166  # The maximum payload size for indexing batches of upgraded saved objects.
   167  # To avoid migrations failing due to a 413 Request Entity Too Large response from Elasticsearch.
   168  # This value should be lower than or equal to your Elasticsearch cluster‚Äôs `http.max_content_length`
   169  # configuration option. Default: 100mb
   170  #migrations.maxBatchSizeBytes: 100mb
   171
   172  # The number of times to retry temporary migration failures. Increase the setting
   173  # if migrations fail frequently with a message such as `Unable to complete the [...] step after
   174  # 15 attempts, terminating`. Defaults to 15
   175  #migrations.retryAttempts: 15
   176
   177  # =================== Search Autocomplete ===================
   178  # Time in milliseconds to wait for autocomplete suggestions from Elasticsearch.
   179  # This value must be a whole number greater than zero. Defaults to 1000ms
   180  #unifiedSearch.autocomplete.valueSuggestions.timeout: 1000
   181
   182  # Maximum number of documents loaded by each shard to generate autocomplete suggestions.
   183  # This value must be a whole number greater than zero. Defaults to 100_000
   184  #unifiedSearch.autocomplete.valueSuggestions.terminateAfter: 100000
root@kibana:/var/log/kibana#

root@kibana:/etc/kibana# systemctl stop kibana
root@kibana:/etc/kibana# systemctl start kibana
root@kibana:/etc/kibana#


root@kibana:/var/log/kibana# tail kibana.log | grep -v INFO,WARN
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.411-04:00","message":"Successfully set up index assets","log":{"level":"INFO","logger":"plugins.observabilityAIAssistant.service"},"process":{"pid":10444,"uptime":95.465067887},"trace":{"id":"470f1d0a45cde0941e25fc8669fa6848"},"transaction":{"id":"ea2c52e8bf298757"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.570-04:00","message":"Fleet setup completed","log":{"level":"INFO","logger":"plugins.fleet"},"process":{"pid":10444,"uptime":95.62536843},"trace":{"id":"63d27bc8679e27e42de1f71467204fe8"},"transaction":{"id":"8511fa564b497fa9"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.705-04:00","message":"xpack.encryptedSavedObjects.encryptionKey is not configured, agent uninstall tokens are being stored in plain text","log":{"level":"WARN","logger":"plugins.fleet"},"process":{"pid":10444,"uptime":95.759157393},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.724-04:00","message":"Dependent plugin setup complete - Starting ManifestTask","log":{"level":"INFO","logger":"plugins.securitySolution"},"process":{"pid":10444,"uptime":95.777172203},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.731-04:00","message":"App feature [endpoint_policy_protections] is enabled. Nothing to do!","log":{"level":"INFO","logger":"plugins.securitySolution.endpoint.policyProtections"},"process":{"pid":10444,"uptime":95.787764526},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.735-04:00","message":"App feature [endpoint_protection_updates] is enabled. Nothing to do!","log":{"level":"INFO","logger":"plugins.securitySolution.endpoint.policyProtections"},"process":{"pid":10444,"uptime":95.788706589},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:58.740-04:00","message":"App feature [endpoint_agent_tamper_protection] is enabled. Nothing to do!","log":{"level":"INFO","logger":"plugins.securitySolution.endpoint.agentPolicyFeatures"},"process":{"pid":10444,"uptime":95.794022365},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:33:59.908-04:00","message":"Install with enablePackagesStateMachine - Starting installation of synthetics@1.3.0 from registry ","log":{"level":"INFO","logger":"plugins.fleet"},"process":{"pid":10444,"uptime":96.961592364},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:34:01.803-04:00","message":"no endpoint installation found","log":{"level":"INFO","logger":"plugins.securitySolution.endpoint:metadata-check-transforms-task:0.0.1"},"process":{"pid":10444,"uptime":98.861449613},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"b0e890ce5d779a16"}}
{"service":{"node":{"roles":["background_tasks","ui"]}},"ecs":{"version":"8.11.0"},"@timestamp":"2025-04-02T22:34:03.787-04:00","message":"Installed synthetics index templates","log":{"level":"INFO","logger":"plugins.synthetics"},"process":{"pid":10444,"uptime":100.840504444},"trace":{"id":"087ca5e495515eab134dda68b7718d4d"},"transaction":{"id":"9b6258ad390e65cd"}}
root@kibana:/var/log/kibana#
### Kibana connected successfully with the elasticsearch certificates:
=== on browser ===
http://192.xxx.xxx.xxx:5601/login?next=%2F
Welcome to Elastic
Username: elastic
Password: superuserpassword 
or user 123456789 # the password that you generated from the command above 





### missing this as well
# Specifies the public URL at which Kibana is available for end users. If
# `server.basePath` is configured this URL should end with the same basePath.
server.publicBaseUrl: "https://localhost:5601"

# The maximum payload size in bytes for incoming server requests.
#server.maxPayload: 1048576

# The Kibana server's name. This is used for display purposes.
#server.name: "your-hostname"

# =================== System: Kibana Server (Optional) ===================
# Enables SSL and paths to the PEM-format SSL certificate and SSL key files, respectively.
# These settings enable SSL for outgoing requests from the Kibana server to the browser.
#server.ssl.enabled: false
#server.ssl.certificate: /path/to/your/server.crt
#server.ssl.key: /path/to/your/server.key


### another issue is that you are using a localhost to access the kibana 

# =================== System: Kibana Server ===================
# Kibana is served by a back end server. This setting specifies the port to use.
server.port: 5601

# Specifies the address to which the Kibana server will bind. IP addresses and host names are both valid values.
# The default is 'localhost', which usually means remote machines will not be able to connect.
# To allow connections from remote users, set this parameter to a non-loopback address.
server.host: "0.0.0.0"     <------------------ if this is not here, it will be listening to port locally on 127.0.0.1:5601

# Enables you to specify a path to mount Kibana at if you are running behind a proxy.
# Use the `server.rewriteBasePath` setting to tell Kibana if it should remove the basePath
# from requests it receives, and to prevent a deprecation warning at startup.
# This setting cannot end in a slash.
#server.basePath: ""

# Specifies whether Kibana should rewrite requests that are prefixed with
# `server.basePath` or require that they are rewritten by your reverse proxy.
# Defaults to `false`.
#server.rewriteBasePath: false

# Specifies the public URL at which Kibana is available for end users. If
# `server.basePath` is configured this URL should end with the same basePath.
server.publicBaseUrl: "http://localhost:5601"
[root@localhost kibana]# netstat -tunalp |grep "5601"
tcp        0      0 0.0.0.0:5601            0.0.0.0:*               LISTEN      8832/node
[root@localhost kibana]#
################################################## trouble shooting ends ##############################################
### we are running elasticsearch with the certificates but we are not running the kibana with certificates
# we are accessing it from the ip only on http, not https

### all the features and all the information which is available with public license of elasticsearch will be visible. 

### dev tools gives you capabiltiy to run the api's and we will be able to get the documents





